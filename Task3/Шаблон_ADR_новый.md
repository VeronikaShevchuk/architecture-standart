### <a name="_b7urdng99y53"></a>**Название задачи:** Архитектурное решение для MVP онлайн-депозитов банка "Стандарт"
### <a name="_hjk0fkfyohdk"></a>**Автор:** Команда цифровой трансформации
### <a name="_uanumrh8zrui"></a>**Дата:** 2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

**Контекст:**
Банк "Стандарт" начинает цифровизацию депозитного направления. Необходимо реализовать MVP для онлайн-подачи заявок на депозиты через сайт и интернет-банк с учетом ограничений существующего IT-ландшафта.

**Ключевые функциональные требования:**

1. **Подача заявок через сайт** (для новых клиентов)
   - Отображение списка доступных депозитов с актуальными ставками
   - Форма заявки с указанием ФИО и номера телефона
   - Интеграция с кол-центром для последующего звонка менеджера

2. **Подача заявок через интернет-банк** (для существующих клиентов)
   - Отображение персонализированных ставок
   - Выбор счета и суммы депозита
   - СМС-подтверждение операции

3. **Управление ставками**
   - Замена Excel-файлов автоматизированной системой
   - Расчет общих и персонализированных ставок
   - Интеграция с данными АБС для анализа рисков

4. **Обработка заявок**
   - Автоматическая передача заявок в АБС
   - Уведомления клиентов о статусе заявки
   - Поддержка ручной обработки менеджерами бэк-офиса

5. **СМС-уведомления**
   - Подтверждение операций
   - Уведомления о статусе заявок
   - Интеграция с существующим СМС-шлюзом

**Нефункциональные требования:**
- Производительность: время отклика UI < 200 мс
- Надежность: доступность 99.9%
- Безопасность: шифрование трафика HTTPS
- Совместимость: использование существующих технологий (.NET, Java, Oracle, MS SQL)

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|**Требования FURPS+**|
| :-: | :- | :- | :- | :- |
| 1 | Клиент (новый) | Подача заявки на депозит через сайт | Клиент просматривает доступные депозиты на сайте, заполняет форму заявки с ФИО и номером телефона для последующего звонка менеджера | **F1**, **U3**, **R3** |
| 2 | Клиент (существующий) | Подача заявки на депозит через интернет-банк | Авторизованный клиент выбирает депозитный продукт, указывает сумму и счет списания, подтверждает операцию СМС-кодом | **F2**, **F5**, **U4**, **R3** |
| 3 | Клиент | Получение СМС-уведомлений | Клиент получает СМС с подтверждением заявки, статусом обработки и результатом открытия депозита | **F6**, **R5**, **+R3** |
| 4 | Оператор кол-центра | Обработка заявки с сайта | Оператор видит новую заявку в системе кол-центра, звонит клиенту для консультации и может предложить особые условия | **F7**, **U1**, **S4** |
| 5 | Менеджер депозитного отдела | Обработка заявки в АБС | Менеджер проверяет и подтверждает заявку в АБС, устанавливает финальную ставку и открывает депозитный счет | **F8**, **U1**, **P6** |
| 6 | Менеджер депозитного отдела | Управление ставками по депозитам | Менеджер рассчитывает и обновляет ставки по депозитам в новой системе вместо Excel-файлов | **F9**, **+R7**, **S1** |
| 7 | Система кол-центра | Синхронизация заявок с АБС | Автоматическая передача данных о заявках из системы кол-центра в АБС для последующей обработки | **F7**, **R5**, **+R1** |
| 8 | Сервис ставок | Расчет персонализированных ставок | Система рассчитывает индивидуальные условия депозитов для клиентов на основе их данных из АБС | **F4**, **F9**, **P1**, **P5** |
| 9 | Сервис нотификаций | Отправка СМС-уведомлений | Автоматическая отправка СМС через телеком-оператора при изменении статуса заявки или открытии депозита | **F6**, **R1**, **S3** |
| 10 | API Gateway | Обработка входящих заявок | Прием и маршрутизация заявок с сайта и интернет-банка к соответствующим сервисам обработки | **P2**, **P3**, **+R1**, **+R3** |
| 11 | Сотрудник фронт-офиса | Идентификация нового клиента | Сотрудник в отделении проводит идентификацию клиента, подавшего заявку через сайт, и завершает открытие депозита | **F8**, **+R6** |
| 12 | Система интернет-банка | Проверка счетов клиента | Проверка доступных средств на счетах клиента и валидация данных перед подачей заявки на депозит | **F2**, **U1**, **P1** |
| 13 | Очередь заявок | Асинхронная обработка заявок | Буферизация и управление потоком заявок для защиты АБС от перегрузки | **P6**, **R1**, **+R1** |
| 14 | Сервис кэширования | Кэширование данных ставок | Хранение актуальных ставок и справочников для обеспечения быстрого отклика интерфейсов | **P1**, **P5**, **U1** |
| 15 | Менеджер кредитного отдела | Анализ кредитных рисков | Предоставление данных для расчета специальных ставок на основе анализа кредитных рисков банка | **F9**, **+R8**, **S1** |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
|**№**|**Требование**|**Категория**|**Метрика**|**Обоснование**|
| :-: | :- | :- | :- | :- |
| 1 | Производительность пользовательского интерфейса | Performance | Время отклика UI < 200 мс | Обеспечение удобства работы клиентов, соответствие современным стандартам |
| 2 | Пропускная способность системы | Performance | Поддержка 1000 одновременных пользователей | Учет потенциального роста онлайн-активности после запуска MVP |
| 3 | Масштабируемость веб-сервисов | Performance | Горизонтальное масштабирование компонентов | Возможность увеличения мощности системы при росте нагрузки |
| 4 | Доступность системы | Reliability | 99.9% uptime (не более 8.7 часов простоя в год) | Обеспечение непрерывности банковских услуг |
| 5 | Отказоустойчивость | Reliability | Автоматическое переключение на резервный ЦОД < 5 минут | Минимизация времени простоя при сбоях |
| 6 | Защита данных | Reliability | Репликация данных между ЦОД, бекапы ежедневно | Предотвращение потери критичных данных |
| 7 | Безопасность передачи данных | Security | Шифрование трафика TLS 1.2+, защита чувствительных данных | Соответствие требованиям регуляторов и стандартам безопасности |
| 8 | Совместимость с технологическим стеком | Supportability | Использование .NET, Java, Oracle, MS SQL | Снижение затрат на обучение и внедрение |
| 9 | Мониторинг и observability | Supportability | Логирование всех операций, метрики производительности | Быстрое выявление и решение проблем |
| 10 | Документация | Supportability | Полная документация архитектуры и API | Облегчение поддержки и дальнейшего развития |
| 11 | Время развертывания | Supportability | Автоматизированное развертывание, downtime < 1 часа | Минимизация воздействия на пользователей |
| 12 | Защита от перегрузки АБС | Performance | Асинхронная обработка заявок, ограничение запросов к АБС | Предотвращение остановки основной банковской системы |
| 13 | Кэширование данных | Performance | Кэширование справочников и ставок, hit rate > 90% | Снижение нагрузки на БД и улучшение отклика UI |
| 14 | Целостность данных | Reliability | Гарантированная доставка сообщений между системами | Обеспечение консистентности финансовых операций |
| 15 | Соответствие брендбуку | Usability | Единая система дизайна во всех приложениях | Поддержание корпоративного стиля и узнаваемости |

### **Архитектурно значимые требования**

|**№**|**Требование**|**Влияние на архитектуру**|
| :-: | :- | :- |
| 1 | Избежание прямой интеграции интернет-банка с API АБС | Требуется внедрение промежуточного слоя (очереди сообщений) для защиты перегруженной БД АБС |
| 2 | Совместимость с текущей версией интернет-банка (.NET 4.5) | Ограничивает выбор технологий (RabbitMQ вместо Kafka), влияет на архитектуру интеграций |
| 3 | Использование существующих СУБД (Oracle, MS SQL) | Определяет выбор технологий хранения данных и влияет на производительность решений |
| 4 | Поддержка существующих процессов идентификации клиентов | Требует гибридной архитектуры с офлайн-компонентами для новых клиентов |
| 5 | Миграция с Excel на автоматизированную систему ставок | Необходимо создание отдельного сервиса управления ставками с API |
| 6 | Разделение доступа к данным между депозитным и кредитным отделами | Требует реализации механизмов авторизации и разграничения прав доступа |
| 7 | Минимизация доработок подрядчиков интернет-банка | Влияет на распределение функциональности между системами |
| 8 | Работа 24/7 без плановых остановок | Требует реализации механизмов горячего развертывания и отказоустойчивости |
| 9 | Горизонтальное масштабирование веб-сервисов | Определяет выбор stateless архитектуры для новых компонентов |
| 10 | Вертикальное масштабирование АБС | Ограничивает производительность системы, требует оптимизации запросов |

### **Критические ограничения производительности**

1. **База данных АБС (Oracle)** уже перегружена - нельзя увеличивать нагрузку
2. **Интернет-банк** работает на одной группе серверов - риск единой точки отказа
3. **Текущая загрузка справочников** > 1 секунда - требует оптимизации
4. **Резервный ЦОД** требует ручного переключения - влияет на время восстановления

### **Требования к мониторингу**

- Мониторинг времени ответа всех API endpoints
- Отслеживание нагрузки на АБС и очередь заявок
- Алертинг при достижении 80% capacity систем
- Логирование всех финансовых операций для аудита

### <a name="_qmphm5d6rvi3"></a>**Решение**

[Контекстная диаграмма - Банк "Стандарт"](Task3\diagrams\Context.puml)

[Диаграмма контейнеров - Банк "Стандарт"](Task3\diagrams\Container.puml)

**Ключевые архитектурные решения на основе FURPS+**

*Реализованные требования:*

- F1-F2 - Многоканальная подача заявок через API Gateway

- F3-F4 - Сервис ставок с персонализацией

- F5-F6 - Унифицированный сервис нотификаций

- U1 - Кэширование для скорости отклика <200ms

- R1-R2 - Резервирование и 24/7 доступность

- P1-P3 - Горизонтальное масштабирование

- S1-S2 - Использование существующего tech stack

- +R1 - Избежание прямой интеграции с АБС

- +R3 - HTTPS шифрование трафика

*Решенные проблемы IT-ландшафта:*

- Защита АБС - асинхронная обработка через очереди

- Замена Excel - автоматизированный сервис ставок

- Совместимость - .NET 4.5 + RabbitMQ вместо Kafka

- Безопасность - уход от прямого доступа к БД

- Производительность - кэширование и горизонтальное масштабирование

Данная архитектура обеспечивает выполнение FURPS+ требований при учете ограничений существующего IT-ландшафта банка "Стандарт".

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

#### **Альтернатива 1: Прямая интеграция интернет-банка с АБС**
**Описание:** Использование существующего подхода с прямыми вызовами API АБС из интернет-банка

*Преимущества:*
- Быстрая реализация (использование существующих паттернов)
- Минимальные изменения в архитектуре
- Низкие первоначальные затраты на разработку

*Недостатки:*
- Риск перегрузки и отказа АБС
- Нарушение требования +R1
- Ограниченная масштабируемость
- Высокая связанность систем

#### **Альтернатива 2: Использование Kafka вместо RabbitMQ**
**Описание:** Применение Apache Kafka как брокера сообщений для асинхронной обработки

*Преимущества:*
- Высокая пропускная способность
- Надежное хранение сообщений
- Поддержка потоковой обработки
- Лучшая масштабируемость на перспективу

*Недостатки:*
- Несовместимость с текущей версией .NET 4.5 (+R4)
- Требует обучения команды
- Высокие операционные затраты
- Избыточность для текущих объемов

#### **Альтернатива 3: Размещение сервиса ставок внутри АБС**
**Описание:** Интеграция функциональности управления ставками в существующую АБС

*Преимущества:*
- Единая точка управления данными
- Упрощенная интеграция
- Использование существующей экспертизы команды АБС

*Недостатки:*
- Увеличение нагрузки на перегруженную АБС
- Сложность внедрения изменений в legacy-систему
- Нарушение принципа единой ответственности
- Риск снижения производительности ядерной системы

#### **Альтернатива 4: Использование облачной инфраструктуры**
**Описание:** Размещение новых сервисов в облаке (Yandex Cloud/AWS)

*Преимущества:*
- Автоматическое масштабирование
- Высокая доступность из коробки
- Современные технологии и сервисы
- Снижение операционных затрат

*Недостатки:*
- Несоответствие требованиям безопасности банка
- Сложность интеграции с внутренними системами
- Требует изменения инфраструктурных процессов
- Зависимость от внешнего провайдера

**Недостатки, ограничения, риски**

#### **Технические ограничения:**

1. *Совместимость с .NET 4.5* - ограничивает выбор современных технологий и библиотек
2. *Производительность АБС* - диктует необходимость асинхронной обработки и кэширования
3. *Legacy архитектура* - сложность интеграции с существующими системами
4. *Вертикальное масштабирование АБС* - ограничивает общую производительность системы

#### **Операционные риски:**
1. *Сложность отладки* распределенной системы с очередями сообщений
2. *Задержки обработки* из-за асинхронной природы могут повлиять на пользовательский опыт
3. *Зависимость от RabbitMQ* - новая технология в стеке банка
4. *Сложность мониторинга* кросс-системных транзакций

#### **Бизнес-риски:**
1. *Сроки реализации* - сложность координации между командами и подрядчиками
2. *Приемка пользователями* - риск низкого уроня принятия новых цифровых каналов
3. *Регуляторные требования* - необходимость соблюдения стандартов безопасности
4. *Бюджетные ограничения* - возможное превышение затрат на инфраструктуру

#### **Архитектурные недостатки:**
1. *Усложнение системы* - добавление новых компонентов увеличивает сложность поддержки
2. *Точки отказа* - появление новых компонентов (очереди, кэш) создает новые риски
3. *Сложность развертывания* - необходимость координации обновлений между системами
4. *Дублирование данных* - между АБС и новыми сервисами требует синхронизации

#### **Митигирующие меры:**

**Для технических ограничений:**
- Поэтапное внедрение с тщательным тестированием нагрузки
- Создание подробной документации 

**Для операционных рисков:**
- Внедрение комплексного мониторинга и алертинга
- Разработка процедур аварийного восстановления
- Обучение команды поддержки новым технологиям

**Для бизнес-рисков:**
- Поэтапный ввод функциональности
- Сбор обратной связи от фокус-групп клиентов
- Регулярная коммуникация с бизнес-заказчиками

**Для архитектурных недостатков:**
- Реализация механизмов компенсирующих транзакций
- Создание подробных ADL
- Планирование регулярных нагрузочных тестов
