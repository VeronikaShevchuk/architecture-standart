### <a name="_b7urdng99y53"></a>**Название задачи:** Интеграция систем кол-центра с сервисом ставок для поддержки пожилых клиентов
### <a name="_hjk0fkfyohdk"></a>**Автор:** Команда цифровой трансформации
### <a name="_uanumrh8zrui"></a>**Дата:** 2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

**Контекст:**
После запуска маркетинговой кампании ожидается значительное увеличение звонков в кол-центр от пожилых клиентов, которым потребуется консультация по ставкам депозитов. Необходимо обеспечить доступ к актуальным ставкам для основного и партнерского кол-центров.

**Ключевые функциональные требования:**

- Интеграция основного кол-центра с сервисом ставок

- API для получения актуальных ставок в реальном времени

- Отображение ставок в интерфейсе оператора

- Кэширование данных для обеспечения отказоустойчивости

- Интеграция с партнерским кол-центром

- Выгрузка файлов со ставками через SFTP

- Автоматическое обновление файлов при изменении ставок

- Формат файлов, совместимый с системой партнера

- Управление распространением ставок

- Централизованное управление доступом к ставкам

- Мониторинг актуальности данных в партнерских системах

- Логирование запросов к ставкам

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| 1 | Клиент | Подача заявки на депозит через сайт | **Основной поток:**<br>1. Клиент заходит на сайт банка<br>2. Просматривает раздел "Депозиты" с актуальными ставками<br>3. Выбирает подходящий депозитный продукт<br>4. Заполняет форму: ФИО, номер телефона, email<br>5. Подтверждает согласие на обработку данных<br>6. Система сохраняет заявку и присваивает номер<br>7. Клиент получает уведомление о принятии заявки<br><br>**Альтернативный поток:**<br>• Если данные заполнены некорректно - система показывает ошибку<br>• Если клиент передумал - может отменить заявку |
| 2 | Клиент | Подача заявки на депозит через интернет-банк | **Основной поток:**<br>1. Клиент авторизуется в интернет-банке<br>2. Переходит в раздел "Вклады и депозиты"<br>3. Видит персонализированные ставки на основе своей истории<br>4. Выбирает тип депозита и сумму<br>5. Указывает счет для списания средств<br>6. Подтверждает операцию СМС-кодом<br>7. Система резервирует средства и создает заявку<br>8. Клиент получает подтверждение<br><br>**Альтернативный поток:**<br>• Если недостаточно средств - система предлагает другие счета<br>• При неверном СМС-коде - запрашивает повторную отправку |
| 3 | Клиент | Консультация по депозитам через кол-центр | **Основной поток:**<br>1. Клиент звонит в кол-центр банка<br>2. Оператор идентифицирует клиента (по номеру телефона или ФИО)<br>3. Оператор просматривает актуальные ставки в системе<br>4. Консультирует по условиям депозитов<br>5. При необходимости создает предварительную заявку<br>6. Клиент получает информацию для принятия решения<br><br>**Альтернативный поток:**<br>• Если клиент новый - оператор объясняет процесс идентификации<br>• При сложных вопросах - оператор передает звонок специалисту |
| 4 | Оператор кол-центра | Консультация клиента по ставкам | **Основной поток:**<br>1. Оператор принимает входящий звонок<br>2. Открывает интерфейс с актуальными ставками из сервиса ставок<br>3. Отвечает на вопросы клиента о условиях депозитов<br>4. При необходимости рассчитывает доходность для конкретной суммы<br>5. Фиксирует обращение в системе<br>6. Предлагает оформить заявку<br><br>**Альтернативный поток:**<br>• Если сервис ставок недоступен - использует кэшированные данные<br>• При технических проблемах - сообщает клиенту о перезвоне |
| 5 | Оператор партнерского кол-центра | Консультация с использованием файловых ставок | **Основной поток:**<br>1. Оператор принимает звонок в партнерском кол-центре<br>2. Открывает локальную систему с импортированными ставками<br>3. Консультирует клиента на основе актуальных данных из файла<br>4. При необходимости перенаправляет звонок в основной кол-центр<br>5. Фиксирует обращение согласно скриптам банка<br><br>**Альтернативный поток:**<br>• Если файл устарел - оператор сообщает о необходимости уточнения<br>• При сложных вопросах - передает звонок основному кол-центру |
| 6 | Менеджер депозитного отдела | Обработка заявки на депозит | **Основной поток:**<br>1. Менеджер открывает АБС и видит новую заявку<br>2. Проверяет данные клиента и корректность заявки<br>3. Рассчитывает финальную ставку (для специальных условий)<br>4. Подтверждает заявку и открывает депозитный счет<br>5. Система автоматически отправляет СМС-уведомление клиенту<br>6. Менеджер проверяет завершение операции<br><br>**Альтернативный поток:**<br>• Если нужна дополнительная проверка - отправляет заявку на согласование<br>• При отклонении заявки - указывает причину и уведомляет клиента |
| 7 | Сервис ставок | Обновление ставок для партнерского кол-центра | **Основной поток:**<br>1. Сервис ставок обнаруживает изменение ставок<br>2. Формирует файл с актуальными данными в установленном формате<br>3. Загружает файл на SFTP сервер банка<br>4. Система партнерского кол-центра автоматически забирает файл<br>5. Обновляет локальную базу данных ставок<br>6. Отправляет подтверждение об успешном обновлении<br><br>**Альтернативный поток:**<br>• При ошибке передачи - повторяет попытку через 5 минут<br>• После 3 неудачных попыток - отправляет уведомление администратору |
| 8 | Система кол-центра | Получение актуальных ставок через API | **Основной поток:**<br>1. Оператор открывает интерфейс консультанта<br>2. Система отправляет запрос к Rate API сервиса ставок<br>3. Сервис возвращает актуальные ставки в формате JSON<br>4. Система отображает ставки в интерфейсе оператора<br>5. Данные кэшируются на 1 минуту для производительности<br><br>**Альтернативный поток:**<br>• При недоступности API - используются кэшированные данные<br>• Если кэш пуст - показывается сообщение о временной недоступности |
| 9 | Администратор | Мониторинг системы распространения ставок | **Основной поток:**<br>1. Администратор открывает панель мониторинга<br>2. Проверяет статус API сервиса ставок<br>3. Контролирует актуальность данных в партнерских системах<br>4. Просматривает логи SFTP передач<br>5. При обнаружении проблем - принимает меры по восстановлению<br><br>**Альтернативный поток:**<br>• При сбое SFTP передачи - запускает ручную выгрузку<br>• При проблемах с API - проверяет логи и перезапускает сервис |
| 10 | Новый клиент | Завершение открытия депозита в отделении | **Основной поток:**<br>1. Клиент приходит в отделение с паспортом<br>2. Сотрудник фронт-офиса находит заявку по номеру телефона/ФИО<br>3. Проводит идентификацию личности<br>4. Подтверждает открытие депозита в АБС<br>5. Распечатывает договор и выдает клиенту<br>6. Клиент подписывает документы<br><br>**Альтернативный поток:**<br>• Если клиент передумал - заявка архивируется с пометкой<br>• При несоответствии данных - требуется заполнение новой заявки |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|**Категория**|**Метрика**|**Обоснование**|
| :-: | :- | :- | :- | :- |
| 1 | Производительность API ставок | Performance | Время ответа < 100 мс для 95% запросов | Обеспечение мгновенного отображения ставок при консультациях |
| 2 | Доступность сервиса ставок | Reliability | 99.95% uptime в рабочее время кол-центра | Непрерывность консультационной поддержки клиентов |
| 3 | Актуальность данных у партнера | Performance | Максимальная задержка обновления ставок < 5 минут | Снижение риска консультаций по устаревшим данным |
| 4 | Пропускная способность кол-центра | Performance | Поддержка 500 одновременных операторов | Обработка пиковой нагрузки после маркетинговой кампании |
| 5 | Безопасность передачи файлов | Security | Шифрование SFTP трафика, двухфакторная аутентификация | Защита финансовой информации при передаче партнеру |
| 6 | Масштабируемость сервиса ставок | Performance | Горизонтальное масштабирование до 10 инстансов | Поддержка роста нагрузки при расширении каналов |
| 7 | Отказоустойчивость кэширования | Reliability | Резервирование Redis кластера, авто-восстановление при сбоях | Гарантия доступности ставок при проблемах с основным сервисом |
| 8 | Совместимость форматов данных | Supportability | Поддержка CSV, JSON форматов для разных систем | Упрощение интеграции с разнородными системами партнеров |
| 9 | Мониторинг доставки данных | Supportability | Отслеживание времени доставки файлов, алертинг при сбоях | Быстрое выявление проблем в цепочке распространения ставок |
| 10 | Производительность UI кол-центра | Usability | Время загрузки интерфейса < 2 секунд | Обеспечение комфортной работы операторов |
| 11 | Надежность SFTP сервера | Reliability | Автоматическое переключение на резервный сервер при сбое | Гарантия бесперебойной доставки файлов партнерам |
| 12 | Совместимость с legacy системами | Supportability | Поддержка .NET Framework 4.5 для интеграции | Сохранение работоспособности существующего интернет-банка |
| 13 | Емкость кэширования | Performance | Хранение ставок за последние 30 дней, кэш-hit rate > 95% | Снижение нагрузки на основную БД и обеспечение отказоустойчивости |
| 14 | Производительность АБС | Performance | Ограничение запросов к АБС - не более 100 RPS | Защита перегруженной основной системы от коллапса |
| 15 | Безопасность доступа к API | Security | Rate limiting - 1000 запросов/мин на ключ API | Защита от DDoS атак и злоупотреблений |

### **Архитектурно значимые требования**

|**№**|**Требование**|**Влияние на архитектуру**|**Критичность**|
| :-: | :- | :- | :-: |
| 1 | Реальное время обновления ставок в основном кол-центре | Требуется прямая интеграция через API с кэшированием | Высокая |
| 2 | Периодическое обновление ставок в партнерском кол-центре | Необходимость реализации SFTP файлового обмена | Высокая |
| 3 | Защита АБС от перегрузки | Обязательное использование асинхронной обработки через очереди | Критическая |
| 4 | Поддержка пожилых клиентов | Требуется дублирование информации в разных каналах | Средняя |
| 5 | Интеграция с legacy интернет-банком | Ограничение в выборе технологий (.NET 4.5 совместимость) | Высокая |
| 6 | Масштабируемость под пиковые нагрузки | Архитектура должна поддерживать горизонтальное масштабирование | Высокая |
| 7 | Отказоустойчивость сервиса ставок | Требуется резервирование и механизмы graceful degradation | Высокая |
| 8 | Безопасность финансовых данных | Обязательное шифрование трафика и строгая аутентификация | Критическая |
| 9 | Совместимость с партнерскими системами | Поддержка стандартных форматов данных и протоколов | Средняя |
| 10 | Мониторинг кросс-системных транзакций | Требуется единая система логирования и трассировки | Средняя |

### **Требования к качеству данных**

|**Параметр**|**Требование**|**Метрика**|
| :-: | :- | :-: |
| Актуальность ставок | Максимальное время распространения | < 5 минут |
| Полнота данных | Отсутствие пропущенных продуктов | 100% продуктов |
| Консистентность | Единые ставки во всех системах | 100% соответствие |
| Доступность истории | Хранение исторических ставок | 30 дней |
| Целостность данных | Отсутствие corruption при передаче | 0 ошибок передачи |

### **Требования к мониторингу**

- *Производительность:* Время ответа API, hit rate кэша, нагрузка на БД
- *Доступность:* Uptime сервисов, статус SFTP передач, доступность АБС
- *Бизнес-метрики:* Количество консультаций, успешные заявки, конверсия
- *Безопасность:* Попытки несанкционированного доступа, аномальная активность

### **Ограничения инфраструктуры**

1. *АБС:* Вертикальное масштабирование, пиковая нагрузка 100 RPS
2. *Интернет-банк:* .NET 4.5, ограниченная горизонтальная масштабируемость
3. *Сеть:* Пропускная способность между ЦОД, задержки репликации
4. *Безопасность:* Требования регуляторов к хранению финансовых данных


### <a name="_qmphm5d6rvi3"></a>**Решение**

[Диаграмма контейнеров - Интеграция кол-центров с сервисом ставок](Task4\diagrams\Container.puml)

[Контекстная диаграмма - Интеграция кол-центров с сервисом ставок](Task4\diagrams\Context.puml)

#### **Обоснование выбора решения**

**Выбрано:** Комбинированное решение (API + SFTP) как оптимальный баланс

*Причины выбора:*
1. **Соответствие ограничениям партнера** - SFTP решает проблему совместимости
2. **Производительность для основных систем** - API обеспечивает real-time доступ
3. **Безопасность** - разделение каналов снижает риски
4. **Постепенная миграция** - возможность перевода партнера на API в будущем
5. **Отказоустойчивость** - независимые каналы работы

*Компромиссы:*
-  Сложность поддержки двух каналов распространения
-  Задержка данных у партнера (до 5 минут)
-  Дополнительные компоненты инфраструктуры

*Митигирующие меры:*
- Единая бизнес-логика генерации ставок
- Общий мониторинг обоих каналов
- План миграции на единый API в долгосрочной перспективе


### <a name="_bjrr7veeh80c"></a>**Альтернативы**

#### **Альтернатива 1: Единый веб-сервис ставок для всех систем**
**Описание:** Создание единого REST API сервиса ставок с доступом для всех систем, включая партнерский кол-центр

*Архитектурное решение:*
- Единая точка доступа к ставкам через REST API
- OAuth 2.0 аутентификация для партнеров
- Rate limiting и квоты для разных потребителей
- Real-time обновления через WebSocket для основных систем

*Преимущества:*
-  Единая точка управления и обновления ставок
-  Real-time доступ ко всем системам
-  Упрощенная архитектура и мониторинг
-  Быстрое распространение изменений

*Недостатки:*
-  Требует изменений у партнера (отказ от файлового обмена)
-  Зависимость от интернет-соединения у партнера
-  Риск единой точки отказа
-  Сложность миграции партнера на новую систему

*Соответствие требованиям:*
-  Производительность: Высокая (real-time)
-  Безопасность: Средняя (риски API)
-  Поддерживаемость: Высокая
-  Стоимость: Средняя

---

#### **Альтернатива 2: Репликация базы данных ставок**
**Описание:** Создание read-only реплики базы данных ставок для партнерского кол-центра

*Архитектурное решение:*
- Master-реплика базы данных MS SQL
- Автоматическая синхронизация изменений
- Прямой доступ партнера к реплике через VPN
- Регулярные снепшоты для аналитики

*Преимущества:*
-  Максимальная производительность доступа
-  Минимальная задержка данных
-  Отказоустойчивость (работа при недоступности основного сервиса)
-  Простота реализации для партнера

*Недостатки:*
-  Высокие риски безопасности (прямой доступ к БД)
-  Сложность управления репликацией
-  Высокие операционные затраты
-  Нарушение принципов микросервисной архитектуры

*Соответствие требованиям:*
-  Производительность: Очень высокая
-  Безопасность: Низкая (критические риски)
-  Поддерживаемость: Низкая
-  Стоимость: Высокая

---

#### **Альтернатива 3: Гибридная модель с веб-хуками**
**Описание:** Комбинированное решение: API для основных систем + веб-хуки для партнеров при изменении ставок

*Архитектурное решение:*
- REST API для внутренних систем банка
- Веб-хуки для уведомления партнеров об изменениях
- Партнер самостоятельно запрашивает файл при получении уведомления
- Резервный механизм по расписанию

*Преимущества:*
-  Баланс между real-time и batch обработкой
-  Гибкость для партнера (может выбирать момент обновления)
-  Снижение нагрузки на SFTP сервер
-  Отказоустойчивость (дублирующие механизмы)

*Недостатки:*
-  Усложнение архитектуры
-  Требует реализации веб-хуков у партнера
-  Дополнительные точки отказа
-  Сложность отладки распределенной системы

*Соответствие требованиям:*
-  Производительность: Высокая
-  Безопасность: Средняя
-  Поддерживаемость: Средняя
-  Стоимость: Средняя

---

#### **Альтернатива 4: Полностью файловая модель**
**Описание:** Унификация подхода - все системы работают через файловый обмен

*Архитектурное решение:*
- Единый SFTP сервер для всех потребителей
- Стандартизированные форматы файлов (CSV, XML, JSON)
- Механизм версионирования файлов
- Уведомления о новых версиях через email/систему мониторинга

*Преимущества:*
-  Максимальная совместимость с legacy системами
-  Простота реализации для партнеров
-  Отказоустойчивость (файлы сохраняются при сбоях)
-  Низкие требования к инфраструктуре

*Недостатки:*
-  Высокая задержка распространения данных
-  Риск использования устаревших данных
-  Сложность управления версиями
-  Ограниченная производительность при частых изменениях

*Соответствие требованиям:*
-  Производительность: Низкая
-  Безопасность: Средняя
-  Поддерживаемость: Высокая
-  Стоимость: Низкая



## Недостатки, ограничения и риски выбранного решения

### Технические ограничения

#### **Двойная система распространения данных**
- **Проблема:** Поддержка двух независимых каналов (API + SFTP) увеличивает сложность системы
- **Влияние:** Риск расхождения данных, повышенные затраты на поддержку
- **Вероятность:** Высокая
- **Меры снижения:** Единый источник данных, автоматические тесты консистенции

#### **Задержка обновления у партнера**
- **Проблема:** Максимальная задержка до 5 минут при файловом обмене
- **Влияние:** Клиенты могут получать устаревшую информацию о ставках
- **Вероятность:** Высокая  
- **Меры снижения:** Уведомления о времени обновления, ограничение частоты изменений ставок

#### **Зависимость от SFTP инфраструктуры**
- **Проблема:** Сбои передачи файлов из-за сетевых проблем или перегрузки сервера
- **Влияние:** Полное отсутствие актуальных данных у партнерского кол-центра
- **Вероятность:** Средняя
- **Меры снижения:** Мониторинг передач, автоматические повторы, резервные каналы

### Архитектурные риски

#### **Нарушение принципов архитектуры**
- **Проблема:** Распределение логики между несколькими сервисами усложняет поддержку
- **Влияние:** Трудности при отладке и внесении изменений
- **Вероятность:** Высокая
- **Меры снижения:** Четкое разделение ответственности, подробная документация

#### **Сложность мониторинга**
- **Проблема:** Трудности отслеживания сквозных транзакций через все системы
- **Влияние:** Длительное время диагностики проблем
- **Вероятность:** Средняя
- **Меры снижения:** Распределенная трассировка, единые идентификаторы запросов

### Операционные риски

#### **Перегрузка сервиса ставок**
- **Проблема:** Пиковые нагрузки при одновременном изменении ставок во всех системах
- **Влияние:** Замедление работы или полный отказ сервиса
- **Вероятность:** Средняя
- **Меры снижения:** Rate limiting, асинхронная обработка, кэширование

#### **Угрозы безопасности**
- **Проблема:** Риск перехвата или модификации файлов при передаче
- **Влияние:** Утечка коммерческой информации, финансовые потери
- **Вероятность:** Низкая
- **Меры снижения:** Шифрование SFTP, цифровая подпись файлов, ротация ключей

### Бизнес-риски

#### **Низкое принятие цифровых каналов**
- **Проблема:** Пожилые клиенты не готовы к использованию онлайн-сервисов
- **Влияние:** Недостижение KPI по цифровизации, рост нагрузки на отделения
- **Вероятность:** Высокая
- **Меры снижения:** Поэтапный запуск, обучение клиентов, упрощенные интерфейсы

#### **Несоответствие ожиданиям клиентов**
- **Проблема:** Клиенты ожидают мгновенного открытия депозитов онлайн
- **Влияние:** Недовольство сервисом, отток клиентов
- **Вероятность:** Средняя
- **Меры снижения:** Прозрачная коммуникация сроков, уведомления о статусе

### Риски интеграции

#### **Нестабильность интеграции с АБС**
- **Проблема:** Сбои при передаче данных в основную банковскую систему
- **Влияние:** Невозможность завершения операций по открытию депозитов
- **Вероятность:** Высокая
- **Меры снижения:** Асинхронная обработка, retry механизмы, мониторинг нагрузки

#### **Зависимость от подрядчиков**
- **Проблема:** Задержки внесения изменений в интернет-банк подрядчиками
- **Влияние:** Срыв сроков реализации проекта
- **Вероятность:** Средняя
- **Меры снижения:** Раннее вовлечение подрядчиков, четкие требования, резервные планы

## Матрица критичности рисков

| Уровень влияния | Низкая вероятность | Средняя вероятность | Высокая вероятность |
|-----------------|-------------------|---------------------|---------------------|
| **Критическое** | Безопасность данных | Нестабильность АБС | - |
| **Высокое**     | - | Перегрузка сервиса<br>Несоответствие ожиданиям | Двойная система<br>Низкое принятие |
| **Среднее**     | - | Задержка данных<br>Мониторинг<br>Зависимость от подрядчиков | Нарушение архитектуры |

## План управления рисками

### Критические риски (немедленное внимание)
- Ежедневный мониторинг нагрузки на АБС
- Регулярные аудиты безопасности SFTP
- План аварийного восстановления сервиса ставок

### Высокие риски (регулярный контроль)
- Нагрузочное тестирование перед запуском
- Резервные каналы коммуникации с клиентами
- Процедуры эскалации к подрядчикам

### Средние риски (плановый мониторинг)
- Еженедельная проверка консистентности данных
- Обучение операторов работе с системой
- Сбор обратной связи от клиентов

